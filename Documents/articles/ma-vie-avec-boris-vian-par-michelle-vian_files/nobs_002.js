window.log=function(){log.history=log.history||[];log.history.push(arguments);if(this.console){arguments.callee=arguments.callee.caller;var a=[].slice.call(arguments);(typeof console.log==="object"?log.apply.call(console.log,console,a):console.log.apply(console,a))}};
(function(b){function c(){}for(var d="assert,count,debug,dir,dirxml,error,exception,group,groupCollapsed,groupEnd,info,log,timeStamp,profile,profileEnd,time,timeEnd,trace,warn".split(","),a;a=d.pop();){b[a]=b[a]||c}})((function(){try
{console.log();return window.console;}catch(err){return window.console={};}})());
(function(){var detect={init:function(){this.browser=this.searchString(this.dataBrowser)||"An unknown browser";this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"an unknown version";this.OS=this.searchString(this.dataOS)||"an unknown OS"},searchString:function(data){for(var i=0;i<data.length;i++){var dataString=data[i].string,dataProp=data[i].prop;this.versionSearchString=data[i].versionSearch||data[i].identity;if(dataString){if(dataString.indexOf(data[i].subString)!=-1)return data[i].identity}else if(dataProp)return data[i].identity};return},searchVersion:function(dataString){var index=dataString.indexOf(this.versionSearchString);if(index==-1)return;return parseFloat(dataString.substring(index+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],dataOS:[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone/iPod"},{string:navigator.platform,subString:"Linux",identity:"Linux"}]};document.head=document.head||document.getElementsByTagName('head')[0];var settings={debug:true,base_url:location.protocol+"//"+location.hostname+"/",api_url:null,sso_url:null,provider_url:null,fb_key:null};this.Cad={__DOMEvents:{},__DOMShortcuts:{hasClass:function(cls){return this.className.match(new RegExp('(\\s|^)'+cls+'(\\s|$)'))},addClass:function(cls){if(!this.hasClass(cls))this.className+=" "+cls},removeClass:function(cls){if(this.hasClass(cls)){var reg=new RegExp('(\\s|^)'+cls+'(\\s|$)');this.className=this.className.replace(reg,' ')}},event:function(type,callback){var event_callback=function(evt){for(p in Cad.__DOMEvents[type][this])if(typeof Cad.__DOMEvents[type][this][p]=="function")Cad.__DOMEvents[type][this][p](evt)};if(Cad.__DOMEvents[type]==undefined)Cad.__DOMEvents[type]={};if(Cad.__DOMEvents[type][this]==undefined)Cad.__DOMEvents[type][this]=[];Cad.__DOMEvents[type][this].push(callback);eval("this.on"+type+" = event_callback;")},eventdel:function(type,callback){if(Cad.__DOMEvents[type]!=undefined&&Cad.__DOMEvents[type][this]!=undefined)for(p in Cad.__DOMEvents[type][this])if(Cad.__DOMEvents[type][this][p]==callback)Cad.__DOMEvents[type][this][p]=undefined},eventsdel:function(type){if(Cad.__DOMEvents[type]!=undefined&&Cad.__DOMEvents[type][this]!=undefined)Cad.__DOMEvents[type][this]=undefined},append:function(node){this.appendChild(node)},prepend:function(node){this.insertBefore(node,this.firstChild)},remove:function(){this.parentNode.removeChild(this)}},init:function(opts){if(!!opts)settings=this.merge(settings,opts,true);this.log(settings);detect.init();this.log(detect)},get:function(name){if(name!=undefined)return settings[name];return settings},merge:function(obj1,obj2,force){for(var p in obj2)if(force||obj1[p]===undefined)obj1[p]=obj2[p];return obj1},switch_blur:function(elt,text){$(elt).removeEvents("focus");$(elt).removeEvents("blur");$(elt).addEvent("focus",function(){if(this.value==text)this.value=""});$(elt).addEvent("blur",function(){if(this.value=="")this.value=text})},alert:function(message,callback,can_close){if(can_close==undefined)can_close=true;if(!SqueezeBox){alert(message)}else SqueezeBox.open(message,{handler:'string',closable:can_close,closeBtn:can_close,onClose:callback,size:{x:null,y:null}})},$:function(node){if(typeof node=='string')node=document.getElementById(node);if(node!=undefined)for(var key in Cad.__DOMShortcuts)if(typeof node[key]=='undefined')node[key]=Cad.__DOMShortcuts[key];return node},id:function(id){return this.$(id)},create:function(type,opts,append){var elt=document.createElement(type);if(opts!=undefined)for(p in opts)if(p=='html'){elt.innerHTML=opts[p]}else if(typeof p=='string')elt.setAttribute(p,opts[p]);if(append!=undefined)this.$(append).append(elt);Cad.log("Cad.create - Appel : "+type);return elt},log:function(message){if(Cad.get('debug')==true&&typeof console!='undefined')console.log(message)},error:function(message){if(console!=undefined)console.error(message)}};this.Cad.Iframe={create:function(name){var iframe=Cad.id(name);if(!iframe){var style='display:none;border:0;padding:0;margin:0;';Cad.create("div",{html:'<iframe style="'+style+'" frameborder="0" scrolling="no"  name="'+name+'" id="'+name+'"></iframe>'},document.body);iframe=Cad.id(name);Cad.log("Cad.Iframe - Appel .create : "+name)};return iframe},window:function(name){var iframe=Cad.id(name);if(iframe==undefined)return null;return iframe.contentWindow||iframe},document:function(name){var iframe=Cad.id(name);if(iframe==undefined)return null;return iframe.contentDocument||iframe.contentWindow.document}}})();

(function(){var _interval=null,alreadyLaunch=false,queu=[],pass=[];Cad.Action={__callback:null,init:function(){if(alreadyLaunch===false){alreadyLaunch=true;window.setInterval(function(){if(!Cad.Action.listening()&&queu.length>0){var param=queu.shift();if(param!=undefined)Cad.Action.call(param.uri,param.callback)}},100)}},listening:function(){return _interval!=null?true:false},listen:function(callback){_interval=window.setInterval(function(){if(Cad.Action.__callback!=null){window.clearInterval(_interval);_interval=null;var response=Cad.Action.__callback;Cad.Action.__callback=null;if(typeof callback=="function")callback(response)}},100)},enqueu:function(uri,callback){if(!uri)return;queu.push({uri:uri,callback:callback})},action:function(action,param,callback,clear){var uri=Cad.get("api_url")+action+"?"+param;if(clear==true)this.clear(uri);Cad.Action.enqueu(uri,callback)},clear:function(uri){if(uri=="*"){pass=[]}else{var new_pass=[];for(var i=0,l=pass.length;i<l;i++)if(pass[i].uri!=uri)new_pass.push(pass[i]);pass=new_pass}},call:function(uri,callback){Cad.log("Cad.Action - Appel .call : `"+uri+"`");for(var i=0,l=pass.length;i<l;i++)if(pass[i].uri==uri){if(typeof callback=='function')callback(pass[i].content);Cad.log("Cad.Action - Fin .call (from cache) : `"+uri+"`");return};var date=new Date(),s=Cad.create('script',{async:'true',src:uri+(uri.match(/\?/g)?"&":"?")+"t="+(date.getTime())},document.head);Cad.Action.listen(function(content){pass.push({uri:uri,callback:callback,content:content});Cad.log("Cad.Action - Fin .call : `"+uri+"`");if(typeof callback=='function')callback(content);Cad.$(s).remove()})}}})();

(function(){Cad.log(location.host.split('.').slice(-2).join('.'));var infos=null,cookie_name="__ucadcook",cookie_domain="."+location.host.split('.').slice(-2).join('.');this.Cad.Sso={clear:function(){infos=null},getcookie:function(){var cookie=GetCookie(cookie_name);return!cookie?null:cookie},setcookie:function(content){var today=null;if(this.getcookie()==null&&content!=null)SetCookie(cookie_name,content,today,'/',cookie_domain)},rmcookie:function(){RemoveCookie(cookie_name,'/',cookie_domain)},data:function(callback,clear){if(clear==true)this.clear();if(infos==null){var cookie=this.getcookie();if(cookie!=null){Cad.Action.action("userdata","token="+encodeURIComponent(cookie),function(user_data){if(typeof callback!='undefined')callback(user_data);if(user_data.error==true){Cad.Sso.rmcookie();infos=null}else Cad.Sso.setcookie(user_data.token)},clear)}else{var uri=Cad.get("sso_url")+"login.php?";uri+="ok="+encodeURIComponent(Cad.get("api_url")+"userdata");uri+="&ko="+encodeURIComponent(Cad.get("api_url")+"userdata");if(clear==true)Cad.Action.clear(uri);Cad.Action.enqueu(uri,function(user_data){if(typeof callback!='undefined')callback(user_data);if(user_data.error!=true){infos=user_data;Cad.Sso.setcookie(user_data.token)}})}}else if(typeof callback!='undefined')callback(infos)},logout:function(callback){var uri=Cad.get("sso_url")+"logout.php?";uri+="ok="+encodeURIComponent(Cad.get("api_url")+"logout");uri+="&ko="+encodeURIComponent(Cad.get("api_url")+"logout?er=2");Cad.Action.enqueu(uri,function(content){if(typeof callback!='undefined')callback(content);Cad.Sso.rmcookie()})},login:function(login,passwd,callback){var uri_scr=Cad.get("sso_url")+"login.php?user="+encodeURIComponent(login)+"&passwd="+encodeURIComponent(passwd);uri_scr+="&ok="+encodeURIComponent(Cad.get("api_url")+"login?er=-1");uri_scr+="&ko="+encodeURIComponent(Cad.get("api_url")+"login?er=1");Cad.Action.enqueu(uri_scr,function(content){if(content.token!=false)Cad.Sso.setcookie(content.token);if(typeof callback!='undefined')callback(content)});var iframe=Cad.Iframe.create("cad-user-login");iframe.src=uri_scr}}})();

(function(){var format={google:[870,540],yahoo:[500,530],facebook:[550,300],twitter:[770,400],linkedin:[550,480],abonnes:[550,400]},login_fields='<ul class="leplus-list-provider">	<li><a href="#leplus" title="Mon compte LePlus" class="sprite leplus-connect_off">&nbsp;</a></li>	<li class="separator">&nbsp;</li>	<li class="lightmod"><a href="#facebook" title="Mon compte Facebook" class="sprite facebook-connect_off">&nbsp;</a></li>	<li class="lightmod"><a href="#twitter" title="Mon compte Twitter" class="sprite twitter-connect_off">&nbsp;</a></li>	<li class="lightmod"><a href="#google" title="Mon compte Google" class="sprite google-connect_off">&nbsp;</a></li>	<li class="lightmod"><a href="#yahoo" title="Mon compte Yahoo" class="sprite yahoo-connect_off">&nbsp;</a></li>	<li class="lightmod"><a href="#linkedin" title="Mon compte LinkedIn" class="sprite linkin-connect_off">&nbsp;</a></li>	<li class="separator">&nbsp;</li>	<li><a href="#nouvelobs" title="Mon accès abonné Le NouvelObs" class="sprite obs-connect_off">&nbsp;</a></li>	<li><a href="#sea" title="Mon accès abonné Sciences et Avenir" class="sprite sea-connect_off">&nbsp;</a></li>	<li><a href="#challenges" title="Mon accès abonné Challenges" class="sprite challa-connect_off">&nbsp;</a></li></ul><div class="clear" style="clear: both;"></div>',winter=null;Cad.Socialize={callback:null,prov:null,prov_key:null,abo:null,cookie_name:"__ucadinvit",getUrl:function(){return Cad.get("provider_url")},getConnectUrl:function(){return Cad.get("connect_url")},clear:function(){if(winter!=null){window.clearInterval(winter);winter=null}},save:function(){var today=new Date();today.setYear(today.getYear()+1920);SetCookie(this.cookie_name,JSON.encode({prov_key:Cad.Socialize.prov_key,abo:Cad.Socialize.abo}),today,'/')},load:function(){var cookie=GetCookie(this.cookie_name);if(!!cookie)try{cookie=JSON.decode(cookie);Cad.Socialize.prov_key=!Cad.Socialize.prov_key?cookie.prov_key:Cad.Socialize.prov_key;Cad.Socialize.abo=!Cad.Socialize.abo?cookie.abo:Cad.Socialize.abo}catch(e){Cad.log("cookie socialize vide")}},unload:function(){RemoveCookie(this.cookie_name,'/')},insertFields:function(element,opts){var elt=$(element);if(!opts.grey){login_fields=login_fields.replace(/_off/g,'')}else if(!!opts.active)if(opts.active=='abonnes'){login_fields=login_fields.replace('obs-connect_off','obs-connect');login_fields=login_fields.replace('sea-connect_off','sea-connect');login_fields=login_fields.replace('challa-connect_off','challa-connect')}else login_fields=login_fields.replace(opts.active+'-connect_off',opts.active+'-connect');elt.set('html',login_fields);if(opts.light==true)elt.getElement('ul').addClass('lightmod');if(opts.mini==true)elt.getElement('ul').addClass('minimod');elt.getElements('.leplus-list-provider').addEvent('click',function(e){var provider=$(e.target).get('href').replace('#',''),abonnes=['leplus','nouvelobs','sea','challenges'],sociaux=['facebook','linkedin','twitter','yahoo','google'];if(provider=='leplus'){if(opts.popup==true){Cad.Socialize.connect('leplus')}else location.href=Cad.Socialize.connect('leplus',true)}else if(abonnes.contains(provider)){if(opts.popup==true){Cad.Socialize.connect('abonnes')}else location.href=Cad.Socialize.connect('abonnes',true)}else if(sociaux.contains(provider))Cad.Socialize.open(provider);return false})},inscript:function(provider){this.load();var leftVal=(screen.width-550)/2,topVal=(screen.height-400)/2,url=this.getUrl()+"update/?light=1&ud[provider]="+provider+"&prov="+encodeURIComponent(this.prov)+"&prov_key="+encodeURIComponent(this.prov_key)+"&abo="+encodeURIComponent(this.abo),win=window.open(url,null,"dependent=yes,width=550,height=400,toolbar=0,resizable=1,left="+leftVal+",top="+topVal);win.focus();this.clear();winter=window.setInterval(function(){if(!win||win.closed){Cad.log("Cad.Socialize .clear : Fermeture de la popup inscript");Cad.Socialize.clear();Cad.Sso.data(function(data){if(typeof Cad.Socialize.callback=='function'){Cad.Socialize.callback(data)}else if(data!=false)window.parent.location.reload()},true)}},100);return false},link:function(provider){var w=format[provider][0],h=format[provider][1],leftVal=(screen.width-w)/2,topVal=(screen.height-h)/2,win=window.open(this.getUrl()+"link/?token="+Cad.Sso.getcookie()+"&provider="+provider,null,"dependent=yes,width="+w+",height="+h+",toolbar=0,resizable=1,left="+leftVal+",top="+topVal);win.focus();this.clear();winter=window.setInterval(function(){if(!win||win.closed){Cad.log("Cad.Socialize .clear : Fermeture de la popup");Cad.Socialize.clear();Cad.Sso.data(function(data){if(typeof Cad.Socialize.callback=='function'){Cad.Socialize.callback(data)}else if(data!=false)window.location.reload()},true)}},100);return false},connect:function(provider,doNotOpen){this.load();var leftVal=(screen.width-550)/2,topVal=(screen.height-400)/2,url=this.getConnectUrl()+"?light=1&provider="+provider+"&prov="+encodeURIComponent(this.prov)+"&prov_key="+encodeURIComponent(this.prov_key)+"&abo="+encodeURIComponent(this.abo);if(doNotOpen===true)return url;var win=window.open(url,null,"dependent=yes,width=550,height=400,toolbar=0,resizable=1,left="+leftVal+",top="+topVal);win.focus();this.clear();winter=window.setInterval(function(){if(!win||win.closed){Cad.log("Cad.Socialize .clear : Fermeture de la popup connect");Cad.Socialize.clear();Cad.Sso.data(function(data){if(typeof Cad.Socialize.callback=='function'){Cad.Socialize.callback(data)}else if(data!=false)window.parent.location.reload()},true)}},100);return false},open:function(provider){this.load();var w=format[provider][0],h=format[provider][1],leftVal=(screen.width-w)/2,topVal=(screen.height-h)/2,win=window.open(this.getUrl()+"?provider="+provider+"&prov="+encodeURIComponent(this.prov)+"&prov_key="+encodeURIComponent(this.prov_key)+"&abo="+encodeURIComponent(this.abo),null,"dependent=yes,width="+w+",height="+h+",toolbar=0,resizable=1,left="+leftVal+",top="+topVal);win.focus();this.clear();winter=window.setInterval(function(){if(!win||win.closed){Cad.log("Cad.Socialize .clear : Fermeture de la popup");Cad.Socialize.clear();Cad.Sso.data(function(data){if(typeof Cad.Socialize.callback=='function'){Cad.Socialize.callback(data)}else if(data!=false)window.parent.location.reload()},true)}},100)},google:function(){this.open("google");return false},yahoo:function(){this.open("yahoo");return false},facebook:function(){this.open("facebook");return false},twitter:function(){this.open("twitter");return false},linkedin:function(){this.open("linkedin");return false},abonnes:function(){this.open("abonnes");return false}}})();

(function(){this.Cad.Paginate=new Class({Implements:Options,options:{append:false,pagin_url:null,current_page:0,start_page:1,max_page:0,param:'p',bt_next:null,request:null,callback:null},last_elt:null,gopt:{wait:false,callback:null},initialize:function(element,options){this.setOptions(options);this.options.current_page=this.options.start_page;var settings=this.options,_inst=this;if($(element)!=undefined)settings.request=new Request.HTML({append:(settings.append==true)?null:$(element),update:(settings.append==false)?null:$(element),onSuccess:function(){settings.current_page++;Cad.log("page suivante récupérée : "+settings.current_page);var last_elt=$(element).getLast("div");_inst.last_elt=last_elt;var rev=new Fx.Reveal(last_elt,{duration:'150ms',onComplete:function(){if(_inst.gopt.wait==settings.current_page){_inst.gopt.wait=false;if(typeof _inst.gopt.callback=="function")_inst.gopt.callback(last_elt);_inst.gopt.callback=null}else if(_inst.gopt.wait!==false)_inst.next();if(typeof settings.callback=="function")settings.callback(last_elt)}});last_elt.hide();rev.reveal();if(settings.current_page>=settings.max_page&&$(settings.bt_next)!=undefined)$(settings.bt_next).hide()}});if($(settings.bt_next)!=undefined)$(settings.bt_next).addEvent("click",function(){_inst.next();return false})},go:function(page,callback){var settings=this.options;if(page==settings.current_page){if(typeof callback=="function")callback(this.last_elt)}else{this.gopt.wait=page;if(typeof callback=="function")this.gopt.callback=callback}},next:function(data){var settings=this.options;if(data===undefined)data='';if(typeof data=="Object")data=data.toQueryString();Cad.log("entre page suivante : ");Cad.log(settings);if(settings.current_page<settings.max_page)settings.request.get(settings.pagin_url+"&"+settings.param+"="+settings.current_page)}})})();

(function(){this.Cad.Reagir=new Class({Implements:Options,options:{connect_zone:null},_validator:null,_form:null,_sending:false,initialize:function(form,options){if(!$(form)){Cad.log("Le formulaire de réaction n'existe pas.");return};this.setOptions(options);this._form=form;var _inv=this;Cad.switch_blur($(form)['texte'],"Écrire ici...");$(form).addEvent("submit",function(){if($(form)['texte'].value=="Écrire ici...")$(form)['texte'].value=""});$(form).set('send',{onSuccess:function(txt){try{var obj=JSON.decode(txt);if(obj.er!="0"){Cad.alert("Une erreur s'est produite : \n"+obj.msg)}else{$(form).reset();Cad.alert(obj.msg)};_inv._sending=false}catch(e){Cad.alert("Un erreur s'est produite. ("+e+")")}}});this._validator=new Form.Validator.Inline($(form),{stopOnFailure:true,ignoreHidden:false,onFormValidate:function(pass,my_form,event){if(!!pass&&_inv._sending==false){_inv._sending=true;$(my_form).send()};if(!!event)event.preventDefault();return false}});var zone=this.options.connect_zone,nozone=this.options.noconnect_zone;if(!!zone)Cad.Sso.data(function(res){if(!res.error){$$(zone).hide();$$(nozone).show()}else{$$(zone).show();$$(nozone).hide()}})},validator:function(){return this._validator}})})();

(function(){var open=function(action,id,url){SqueezeBox.open("/?action=alerte&origine="+Cad.Moderate.origine+"&content_id="+action+"-"+id+"&url="+encodeURIComponent(url),{handler:'iframe',size:{x:635,y:430}})};this.Cad.Moderate={origine:'NO7AD',contrib:function(id){var LocHref=String(location.href);if(LocHref.lastIndexOf('#')!=-1)LocHref=LocHref.substr(0,LocHref.lastIndexOf('#'));open("contrib",id,LocHref)},reaction:function(id,origine){if(!!origine)this.origine=origine;var LocHref=String(location.href);if(LocHref.lastIndexOf('#')!=-1)LocHref=LocHref.substr(0,LocHref.lastIndexOf('#'));LocHref=LocHref+'#reaction'+id;open("reaction",id,LocHref)},profil:function(id){var LocHref=String(location.href);open("profil",id,LocHref)},reactionprofil:function(id,url){var LocHref=String(url);if(LocHref.lastIndexOf('#')!=-1)LocHref=LocHref.substr(0,LocHref.lastIndexOf('#'));LocHref=LocHref+'#reaction'+id;open("reaction",id,LocHref)}}})();

Cad.init({api_url:'http://api-leplus.nouvelobs.com/api/',connect_url:'http://api-leplus.nouvelobs.com/api/connect/',provider_url:'http://api-leplus.nouvelobs.com/provider/',sso_url:'http://ssobs.nouvelobs.com/',debug:false,fb_key:'eaa2d7f7e819353127ef6232136149af'});Cad.Action.init();

